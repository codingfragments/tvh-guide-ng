# DVR (Digital Video Recorder) API endpoints

/api/dvr/entry/grid:
  get:
    summary: List DVR recordings
    description: |
      Retrieve all DVR recording entries with pagination and filtering.
      Includes scheduled, in-progress, completed, and failed recordings.

      **Common Use Cases:**
      - View recording history
      - Check scheduled recordings
      - Monitor in-progress recordings
      - Find failed recordings for retry
    operationId: getDvrEntryGrid
    tags:
      - DVR
    security:
      - BasicAuth: []
    parameters:
      - $ref: '../components/parameters/pagination.yaml#/StartParameter'
      - $ref: '../components/parameters/pagination.yaml#/LimitParameter'
      - $ref: '../components/parameters/pagination.yaml#/SortParameter'
      - $ref: '../components/parameters/pagination.yaml#/DirParameter'
      - $ref: '../components/parameters/filter.yaml#/FilterParameter'
      - name: status
        in: query
        description: Filter by recording status
        schema:
          type: string
          enum: [scheduled, recording, completed, missed, invalid]
        example: completed
    responses:
      '200':
        description: DVR entries list
        content:
          application/json:
            schema:
              $ref: '../components/schemas/dvr.yaml#/DvrGridResponse'
            examples:
              allRecordings:
                summary: All recordings
                value:
                  entries:
                    - uuid: "dvr-uuid-123"
                      channelname: "BBC One HD"
                      title: "Planet Earth II"
                      start: 1704067200
                      stop: 1704070800
                      status: "completed"
                      filesize: 4294967296
                  total: 1
              scheduledOnly:
                summary: Upcoming recordings
                value:
                  entries:
                    - uuid: "dvr-uuid-456"
                      channelname: "ITV HD"
                      title: "News at Ten"
                      start: 1704153600
                      stop: 1704155400
                      status: "scheduled"
                  total: 1
      '401':
        $ref: '../components/responses/errors.yaml#/Unauthorized'
      '403':
        $ref: '../components/responses/errors.yaml#/Forbidden'

/api/dvr/entry/create:
  post:
    summary: Create manual recording
    description: |
      Create a new manual recording entry.
      Requires recording privilege.

      **Use Cases:**
      - Schedule recording by time and channel
      - Create custom recordings not linked to EPG
    operationId: createDvrEntry
    tags:
      - DVR
    security:
      - BasicAuth: []
    requestBody:
      required: true
      content:
        application/json:
          schema:
            type: object
            properties:
              conf:
                type: object
                properties:
                  channel:
                    type: string
                    description: Channel UUID
                  start:
                    $ref: '../components/schemas/common.yaml#/Timestamp'
                  stop:
                    $ref: '../components/schemas/common.yaml#/Timestamp'
                  title:
                    type: string
                    description: Recording title
                  subtitle:
                    type: string
                  description:
                    type: string
                  pri:
                    $ref: '../components/schemas/common.yaml#/Priority'
                  start_extra:
                    type: integer
                  stop_extra:
                    type: integer
                required:
                  - channel
                  - start
                  - stop
                  - title
          example:
            conf:
              channel: "channel-uuid-123"
              start: 1704067200
              stop: 1704070800
              title: "My Recording"
              pri: 2
              start_extra: 2
              stop_extra: 5
    responses:
      '200':
        description: Recording created successfully
        content:
          application/json:
            schema:
              type: object
              properties:
                uuid:
                  type: string
              example:
                uuid: "new-dvr-uuid-123"
      '400':
        $ref: '../components/responses/errors.yaml#/BadRequest'
      '401':
        $ref: '../components/responses/errors.yaml#/Unauthorized'
      '403':
        $ref: '../components/responses/errors.yaml#/Forbidden'
      '409':
        $ref: '../components/responses/errors.yaml#/Conflict'

/api/dvr/entry/create_by_event:
  post:
    summary: Record EPG event
    description: |
      Create recording from EPG event ID.
      This is the most common way to schedule recordings - simply pass the event ID.

      **Use Cases:**
      - One-click recording from program guide
      - Schedule recording for specific program
    operationId: createDvrEntryByEvent
    tags:
      - DVR
    security:
      - BasicAuth: []
    requestBody:
      required: true
      content:
        application/json:
          schema:
            type: object
            properties:
              event_id:
                type: integer
                format: int64
                description: EPG event ID to record
              config_uuid:
                type: string
                description: Optional DVR config UUID
            required:
              - event_id
          example:
            event_id: 123456
    responses:
      '200':
        description: Recording scheduled successfully
        content:
          application/json:
            schema:
              type: object
              properties:
                uuid:
                  type: string
                  description: Created DVR entry UUID
              example:
                uuid: "dvr-uuid-789"
      '400':
        $ref: '../components/responses/errors.yaml#/BadRequest'
      '401':
        $ref: '../components/responses/errors.yaml#/Unauthorized'
      '403':
        $ref: '../components/responses/errors.yaml#/Forbidden'
      '404':
        description: EPG event not found
        content:
          application/json:
            schema:
              $ref: '../components/schemas/error.yaml#/ErrorResponse'
            example:
              error: "Event not found"

/api/dvr/entry/cancel:
  post:
    summary: Cancel recording
    description: |
      Cancel a scheduled or in-progress recording.
      Does not delete completed recordings (use /remove for that).

      **Use Cases:**
      - Cancel unwanted scheduled recording
      - Stop in-progress recording
    operationId: cancelDvrEntry
    tags:
      - DVR
    security:
      - BasicAuth: []
    requestBody:
      required: true
      content:
        application/json:
          schema:
            type: object
            properties:
              uuid:
                type: string
                description: DVR entry UUID to cancel
            required:
              - uuid
          example:
            uuid: "dvr-uuid-123"
    responses:
      '200':
        description: Recording cancelled successfully
        content:
          application/json:
            schema:
              type: object
              properties:
                success:
                  type: boolean
              example:
                success: true
      '400':
        $ref: '../components/responses/errors.yaml#/BadRequest'
      '401':
        $ref: '../components/responses/errors.yaml#/Unauthorized'
      '403':
        $ref: '../components/responses/errors.yaml#/Forbidden'
      '404':
        $ref: '../components/responses/errors.yaml#/NotFound'

/api/dvr/entry/remove:
  post:
    summary: Delete recording
    description: |
      Permanently delete a recording entry and its file.
      **Warning:** This cannot be undone!

      **Use Cases:**
      - Free up disk space
      - Remove unwanted recordings
    operationId: removeDvrEntry
    tags:
      - DVR
    security:
      - BasicAuth: []
    requestBody:
      required: true
      content:
        application/json:
          schema:
            type: object
            properties:
              uuid:
                type: string
                description: DVR entry UUID to delete
            required:
              - uuid
          example:
            uuid: "dvr-uuid-123"
    responses:
      '200':
        description: Recording deleted successfully
        content:
          application/json:
            schema:
              type: object
              properties:
                success:
                  type: boolean
              example:
                success: true
      '401':
        $ref: '../components/responses/errors.yaml#/Unauthorized'
      '403':
        $ref: '../components/responses/errors.yaml#/Forbidden'
      '404':
        $ref: '../components/responses/errors.yaml#/NotFound'

/api/dvr/autorec/grid:
  get:
    summary: List auto-recording rules
    description: |
      Retrieve all automatic recording rules (series recording, keyword-based, etc.).

      **Use Cases:**
      - View configured series recordings
      - Manage auto-recording rules
    operationId: getDvrAutorecGrid
    tags:
      - DVR
    security:
      - BasicAuth: []
    parameters:
      - $ref: '../components/parameters/pagination.yaml#/StartParameter'
      - $ref: '../components/parameters/pagination.yaml#/LimitParameter'
      - $ref: '../components/parameters/pagination.yaml#/SortParameter'
      - $ref: '../components/parameters/pagination.yaml#/DirParameter'
    responses:
      '200':
        description: Auto-recording rules list
        content:
          application/json:
            schema:
              $ref: '../components/schemas/dvr.yaml#/DvrAutorecGridResponse'
            example:
              entries:
                - uuid: "autorec-uuid-123"
                  enabled: true
                  name: "Record all documentaries"
                  title: ".*documentary.*"
                  fulltext: true
              total: 1
      '401':
        $ref: '../components/responses/errors.yaml#/Unauthorized'
      '403':
        $ref: '../components/responses/errors.yaml#/Forbidden'

/api/dvr/autorec/create:
  post:
    summary: Create auto-recording rule
    description: |
      Create a new automatic recording rule.
      Rules automatically create recordings when matching EPG events are found.

      **Use Cases:**
      - Set up series recording
      - Record all programs matching keywords
      - Record specific content types (e.g., all sports)
    operationId: createDvrAutorec
    tags:
      - DVR
    security:
      - BasicAuth: []
    requestBody:
      required: true
      content:
        application/json:
          schema:
            type: object
            properties:
              conf:
                type: object
                properties:
                  name:
                    type: string
                  title:
                    type: string
                    description: Title filter (regex supported)
                  channel:
                    type: string
                  fulltext:
                    type: boolean
                  contentType:
                    type: integer
                  minduration:
                    type: integer
                  start_extra:
                    type: integer
                  stop_extra:
                    type: integer
                required:
                  - name
          examples:
            seriesRecording:
              summary: Series recording
              value:
                conf:
                  name: "Record Planet Earth II"
                  title: "Planet Earth II.*"
                  channel: "channel-uuid-bbc"
            keywordRecording:
              summary: Keyword-based recording
              value:
                conf:
                  name: "All documentaries"
                  fulltext: true
                  title: "documentary"
                  contentType: 144
    responses:
      '200':
        description: Auto-recording rule created
        content:
          application/json:
            schema:
              type: object
              properties:
                uuid:
                  type: string
              example:
                uuid: "autorec-uuid-456"
      '400':
        $ref: '../components/responses/errors.yaml#/BadRequest'
      '401':
        $ref: '../components/responses/errors.yaml#/Unauthorized'
      '403':
        $ref: '../components/responses/errors.yaml#/Forbidden'

/api/dvr/timerec/grid:
  get:
    summary: List time-based recording rules
    description: |
      Retrieve time-based recording rules (e.g., daily/weekly schedules).

      **Use Cases:**
      - View scheduled recurring recordings
      - Manage time-based rules
    operationId: getDvrTimerecGrid
    tags:
      - DVR
    security:
      - BasicAuth: []
    parameters:
      - $ref: '../components/parameters/pagination.yaml#/StartParameter'
      - $ref: '../components/parameters/pagination.yaml#/LimitParameter'
    responses:
      '200':
        description: Time-based rules list
        content:
          application/json:
            schema:
              $ref: '../components/schemas/dvr.yaml#/DvrTimerecGridResponse'
            example:
              entries:
                - uuid: "timerec-uuid-123"
                  enabled: true
                  name: "Morning News Daily"
                  channel: "channel-uuid-bbc"
                  start: 420
                  stop: 480
                  weekdays: [1, 2, 3, 4, 5]
              total: 1
      '401':
        $ref: '../components/responses/errors.yaml#/Unauthorized'
      '403':
        $ref: '../components/responses/errors.yaml#/Forbidden'
